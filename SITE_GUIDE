IRIS VMCondor Site's Guide
==========================

VMCondor allows users to submit HTCondor batch jobs to a pool of virtual 
machines managed by Vcycle/OpenStack or Vac at IRIS sites. This guide 
explains how sites can run VMCondor VMs to provide capacity for the pool. 

In all cases, please email vmcondor@iris.ac.uk to start the process of
enabling your site.

OpenStack
---------

If you run OpenStack on your hardware or can allocate capacity on an 
OpenStack service (for example, run by your institute's IT Services), 
then you can create a project for IRIS VMCondor and give access to the 
IRIS Vcycle service at Manchester. Vcycle will then create the VMCondor 
VMs in response to observed demand for jobs. Other user communities 
(SKA, LSST, LZ, DUNE, ATLAS, ALICE, LHCb) can be supported in the same
OpenStack project, with their VMs backfilling unused capacity.

Vcycle/OpenStack
----------------

If you have OpenStack and wish more direct control over the shares and 
backfilling policy, you can install and manage your own Vcycle instance.
See https://www.gridpp.ac.uk/vcycle/

Vac
---

Finally, Vac can be used to manage OpenStack-compatible VMs without running
OpenStack on your hardware, with the same set of user communities' VMs as
Vcycle, including VMCondor. Vac requires that the physical worker node
machines are dedicated to it, but is much simpler to install and operate
than OpenStack. See https://www.gridpp.ac.uk/vac/

Vcycle/Vac configuration
------------------------

In addition to the standard configuration of Vcycle or Vac, you should 
add a section to the configuration files like this to support VMCondor:

[vacuum_pipe vmcondor]
vacuum_pipe_url = https://repo.iris.ac.uk/iris-vmcondor/vmcondor.pipe
target_share = CHANGEME

and place an X.509 host certificate and key in the vmcondor subdirectory
of the machinetypes directory as x509cert.pem and x509key.pem (NOT in the
files subdirectory if present).

The certificate should be for a hostname in your organisation's DNS space
such as vmcondor-vm.example.com . It is not necessary that the hostname
is registered in DNS; just that you have authority over it and can receive
a host certificate for it. The certificate must be from the UK eScience CA
at RAL: http://www.ngs.ac.uk/ukca/

Please contact vmcondor@iris.ac.uk with the full DN of this certificate 
and your Vcycle/Vac space name so it can be enabled to receive jobs from 
the VMCondor pool.

